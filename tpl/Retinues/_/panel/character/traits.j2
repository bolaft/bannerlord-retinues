{# ━━━━━━━━━━━━━━━━━━━━━ #}
{#      Traits Block     #}
{# ━━━━━━━━━━━━━━━━━━━━━ #}

{% macro chevron(command, brush, enabled) %}

<ButtonWidget
    IsEnabled="{{ enabled }}"
    WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
    HorizontalAlignment="Center" VerticalAlignment="Center"
    SuggestedWidth="20" SuggestedHeight="20"
    Brush="Popup.Button.Text"
    Command.Click="{{ command }}" UpdateChildrenStates="true" DoNotPassEventsToChildren="true">
    <Children>
        <BrushWidget WidthSizePolicy="Fixed"
            HeightSizePolicy="Fixed"
            SuggestedWidth="20" SuggestedHeight="20"
            Brush="{{ brush }}"/>
    </Children>
</ButtonWidget>

{%- endmacro %}

{% macro trait() -%}

<ListPanel
    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
    StackLayout.LayoutMethod="VerticalBottomToTop"
    HorizontalAlignment="Center">
    <Children>
        <TextWidget
            Text="@Name"
            Brush="Encyclopedia.Skill.Text"
            Brush.FontSize="16"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            HorizontalAlignment="Center" VerticalAlignment="Center" />
        {# Controls #}
        <ListPanel
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            HorizontalAlignment="Center"
            UpdateChildrenStates="true">
            <Children>

                <SpriteWidget
                    WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
                    SuggestedWidth="60" SuggestedHeight="60"
                    Color="@SpriteColor"
                    Sprite="@Sprite"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Children>
                        <HintWidget
                            DataSource="{Tooltip}"
                            Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint"/>
                    </Children>
                </SpriteWidget>

                <ListPanel
                    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
                    HorizontalAlignment="Right" VerticalAlignment="Center"
                    StackLayout.LayoutMethod="VerticalBottomToTop">
                    <Children>

                        {% macro arrow_button(command, brush, enabled) -%}
                            <ButtonWidget
                                IsEnabled="{{ enabled }}"
                                WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
                                VerticalAlignment="Center" HorizontalAlignment="Right"
                                UpdateChildrenStates="true"
                                DoNotPassEventsToChildren="true"
                                Command.Click="{{ command }}">
                                <Children>
                                    <BrushWidget
                                        DoNotAcceptEvents="true"
                                        WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
                                        SuggestedWidth="20" SuggestedHeight="20"
                                        HorizontalAlignment="Center" VerticalAlignment="Center"
                                        Brush="{{ brush }}" />
                                </Children>
                            </ButtonWidget>
                        {%- endmacro %}

                        {{ arrow_button("ExecuteIncrement", "Editor.Arrow.Up", "@CanIncrement") }}
                        {{ arrow_button("ExecuteDecrement", "Editor.Arrow.Down", "@CanDecrement") }}

                    </Children>
                </ListPanel>

            </Children>
        </ListPanel>
    </Children>
</ListPanel>

{%- endmacro %}

{% from "_/panel/character/base.macros.j2" import field_header %}

{# Traits Header #}
{{ field_header("@TraitsHeaderText", "@ShowTraits") }}

{# Traits Grid #}
<ListPanel
    IsVisible="@ShowTraits"
    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
    HorizontalAlignment="Center"
    StackLayout.LayoutMethod="VerticalBottomToTop"
    UpdateChildrenStates="true">
    <Children>
        <ListPanel
            DataSource="{Traits}"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            HorizontalAlignment="Center"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>
                {{ trait() }}
            </ItemTemplate>
        </ListPanel>
    </Children>
</ListPanel>
