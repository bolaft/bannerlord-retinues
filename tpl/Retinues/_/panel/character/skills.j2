{% macro chevron(command, brush, enabled, hint) %}

<Widget
    HorizontalAlignment="Center" VerticalAlignment="Center"
    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren">
    <Children>

        <HintWidget
            DataSource="{{ hint }}"
            Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint"/>

        <ButtonWidget
            IsVisible="{{ enabled }}"
            IsEnabled="true"
            WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
            HorizontalAlignment="Center" VerticalAlignment="Center"
            SuggestedWidth="@ChevronSize" SuggestedHeight="@ChevronSize"
            Brush="Popup.Button.Text"
            Command.Click="{{ command }}" UpdateChildrenStates="true" DoNotPassEventsToChildren="true">
            <Children>
                <BrushWidget WidthSizePolicy="Fixed"
                    HeightSizePolicy="Fixed"
                    SuggestedWidth="@ChevronSize" SuggestedHeight="@ChevronSize"
                    Brush="{{ brush }}"/>
            </Children>
        </ButtonWidget>

        <ButtonWidget
            IsHidden="{{ enabled }}"
            IsEnabled="false"
            WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
            HorizontalAlignment="Center" VerticalAlignment="Center"
            SuggestedWidth="@ChevronSize" SuggestedHeight="@ChevronSize"
            Brush="Popup.Button.Text"
            Command.Click="{{ command }}"
            UpdateChildrenStates="true" DoNotPassEventsToChildren="true">
            <Children>
                <BrushWidget
                    WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
                    SuggestedWidth="20" SuggestedHeight="20"
                    Brush="{{ brush }}"/>
            </Children>
        </ButtonWidget>
    </Children>
</Widget>

{%- endmacro %}

{% macro skill() -%}

<Widget
    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
    MarginBottom="@Margin"
    HorizontalAlignment="Center">
    <Children>

        <ListPanel
            WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
            SuggestedWidth="@IconSize" SuggestedHeight="@Height"
            StackLayout.LayoutMethod="VerticalBottomToTop"
            HorizontalAlignment="Center"
            MarginRight="@BigMargin" MarginLeft="@BigMargin" MarginBottom="@Margin" MarginTop="@SmallMargin">
            <Children>

                <!-- Visual Widget -->
                <SkillIconVisualWidget
                    SkillId="@Id"
                    WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
                    SuggestedWidth="@IconSize" SuggestedHeight="@IconSize"
                    DoNotPassEventsToChildren="false"
                    MarginBottom="@Margin">
                    <Children>
                        <HintWidget
                            DataSource="{Hint}"
                            Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint"/>
                    </Children>
                </SkillIconVisualWidget>

                <!-- Controls -->
                <ListPanel
                    WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren"
                    StackLayout.LayoutMethod="HorizontalLeftToRight"
                    HorizontalAlignment="Center"
                    UpdateChildrenStates="true">
                    <Children>

                        <!-- Decrement Skill -->
                        {{ chevron(
                            command="ExecuteDecrease",
                            brush="ButtonRightBigArrowBrush1",
                            enabled="@CanDecrease",
                            hint="{TooltipDecrease}"
                        ) }}

                        <!-- Skill Value -->
                        <TextWidget
                            IntText="@Value"
                            Brush="Encyclopedia.Skill.Text"
                            Brush.FontColor="@ValueColor"
                            Brush.FontSize="24"
                            WidthSizePolicy="Fixed" HeightSizePolicy="Fixed"
                            SuggestedWidth="@TextWidth" SuggestedHeight="24"
                            HorizontalAlignment="Center" VerticalAlignment="Center" />

                        <!-- Increase Skill -->
                        {{ chevron(
                            command="ExecuteIncrease",
                            brush="ButtonLeftBigArrowBrush1",
                            enabled="@CanIncrease",
                            hint="{TooltipIncrease}"
                        ) }}

                    </Children>
                </ListPanel>
            </Children>
        </ListPanel>
    </Children>
</Widget>

{%- endmacro %}

{% from "_/panel/character/base.macros.j2" import field_header %}

{{ field_header("@SkillsHeaderText") }}

<!-- Skills Grid -->
<ListPanel
    WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
    HorizontalAlignment="Center"
    StackLayout.LayoutMethod="VerticalBottomToTop"
    UpdateChildrenStates="true">
    <Children>

        <ListPanel DataSource="{SkillsRow1}"
            HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

        <ListPanel DataSource="{SkillsRow2}"
            HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

        <ListPanel DataSource="{SkillsRow3}"
            HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

        <ListPanel DataSource="{SkillsRow4}"
            HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

        <!-- Optional extra safety for >24 skills -->
        <ListPanel DataSource="{SkillsRow5}" HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

        <ListPanel DataSource="{SkillsRow6}" HorizontalAlignment="Center"
            WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren"
            StackLayout.LayoutMethod="HorizontalLeftToRight"
            UpdateChildrenStates="true">
            <ItemTemplate>{{ skill() }}</ItemTemplate>
        </ListPanel>

    </Children>
</ListPanel>
